# =============================================================================
# REDIS CONFIGURATION - INTELLIGENCE ANALYZER
# =============================================================================
# Optimized for: 
#   - Message queuing (dead_logs, ingest_logs, clean_logs)
#   - State tracking (brute force counters, port scan sets, beaconing timestamps)
# =============================================================================

# Network
bind 0.0.0.0
port 6379
tcp-keepalive 300

# Memory Management
# =============================================================================
# maxmemory: Cap at 2GB to prevent OOM
# maxmemory-policy: 
#   - allkeys-lru evicts least recently used keys when full
#   - This affects detection state keys (bf:*, ps:*, bc:*) first
#   - Queue lists (dead_logs, ingest_logs, clean_logs) rarely evicted
#     because they're constantly accessed
# =============================================================================
maxmemory 2gb
maxmemory-policy allkeys-lru

# Persistence
# =============================================================================
# save: Snapshot every 60s if 1000+ keys changed (recovery)
# appendonly: WAL for durability (logs replayed on restart)
# =============================================================================
save 60 1000
save 300 10
appendonly yes
appendfsync everysec

# Client handling
maxclients 10000
timeout 0

# Logging
loglevel notice
logfile ""

# Performance
# =============================================================================
# activerehashing: Gradual rehashing, prevents latency spikes
# lazyfree-lazy-eviction: Eviction in background thread
# =============================================================================
activerehashing yes
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
